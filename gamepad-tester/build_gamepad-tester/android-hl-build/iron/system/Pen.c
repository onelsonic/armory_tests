// Generated by HLC 4.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/system/Pen.h>
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
#include <kha/input/Pen.h>
extern hl_type $t_dyn;
#include <hl/natives.h>
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
void iron_system_VirtualInput_new(iron__system__VirtualInput);
kha__input__Pen kha_input_Pen_get(int*);
extern hl_type $t_fun_7ee9d30;
extern hl_type $t_fun_e927665;
extern hl_type $t_fun_792a745;
void kha_input_Pen_notify(kha__input__Pen,vclosure*,vclosure*,vclosure*);

void iron_system_Pen_new__$1(vclosure* r0,int r1,int r2,double r3) {
	double r4, r5;
	r4 = (double)r1;
	r5 = (double)r2;
	r0->hasValue ? ((void (*)(vdynamic*,double,double,double))r0->fun)((vdynamic*)r0->value,r4,r5,r3) : ((void (*)(double,double,double))r0->fun)(r4,r5,r3);
	return;
}

void iron_system_Pen_endFrame(iron__system__Pen r0) {
	hl__types__ArrayObj r1;
	bool r3;
	double r8;
	vdynamic *r7;
	varray *r6;
	int r2, r4;
	r1 = r0->buttonsStarted;
	if( r1 == NULL ) hl_null_access();
	r2 = 0;
	r3 = false;
	r4 = r1->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$719ef83_2_7;
	hl_types_ArrayObj___expand(r1,r2);
	label$719ef83_2_7:
	r6 = r1->array;
	r7 = hl_alloc_dynbool(r3);
	((vdynamic**)(r6 + 1))[r2] = r7;
	r1 = r0->buttonsReleased;
	if( r1 == NULL ) hl_null_access();
	r2 = 0;
	r3 = false;
	r4 = r1->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$719ef83_2_17;
	hl_types_ArrayObj___expand(r1,r2);
	label$719ef83_2_17:
	r6 = r1->array;
	r7 = hl_alloc_dynbool(r3);
	((vdynamic**)(r6 + 1))[r2] = r7;
	r3 = false;
	r0->moved = r3;
	r8 = 0.;
	r0->movementX = r8;
	r8 = 0.;
	r0->movementY = r8;
	return;
}

void iron_system_Pen_reset(iron__system__Pen r0) {
	hl__types__ArrayObj r1;
	bool r3;
	vdynamic *r7;
	varray *r6;
	int r2, r4;
	r1 = r0->buttonsDown;
	if( r1 == NULL ) hl_null_access();
	r2 = 0;
	r3 = false;
	r4 = r1->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$719ef83_3_7;
	hl_types_ArrayObj___expand(r1,r2);
	label$719ef83_3_7:
	r6 = r1->array;
	r7 = hl_alloc_dynbool(r3);
	((vdynamic**)(r6 + 1))[r2] = r7;
	iron_system_Pen_endFrame(r0);
	return;
}

void iron_system_Pen_downListener(iron__system__Pen r0,double r1,double r2,double r3) {
	hl__types__ArrayObj r4;
	bool r6;
	vdynamic *r10;
	varray *r9;
	int r5, r7;
	r4 = r0->buttonsDown;
	if( r4 == NULL ) hl_null_access();
	r5 = 0;
	r6 = true;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$719ef83_4_7;
	hl_types_ArrayObj___expand(r4,r5);
	label$719ef83_4_7:
	r9 = r4->array;
	r10 = hl_alloc_dynbool(r6);
	((vdynamic**)(r9 + 1))[r5] = r10;
	r4 = r0->buttonsStarted;
	if( r4 == NULL ) hl_null_access();
	r5 = 0;
	r6 = true;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$719ef83_4_17;
	hl_types_ArrayObj___expand(r4,r5);
	label$719ef83_4_17:
	r9 = r4->array;
	r10 = hl_alloc_dynbool(r6);
	((vdynamic**)(r9 + 1))[r5] = r10;
	r0->x = r1;
	r0->y = r2;
	r0->pressure = r3;
	return;
}

void iron_system_Pen_upListener(iron__system__Pen r0,double r1,double r2,double r3) {
	hl__types__ArrayObj r4;
	bool r6;
	vdynamic *r10;
	varray *r9;
	int r5, r7;
	r4 = r0->buttonsDown;
	if( r4 == NULL ) hl_null_access();
	r5 = 0;
	r6 = false;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$719ef83_5_7;
	hl_types_ArrayObj___expand(r4,r5);
	label$719ef83_5_7:
	r9 = r4->array;
	r10 = hl_alloc_dynbool(r6);
	((vdynamic**)(r9 + 1))[r5] = r10;
	r4 = r0->buttonsReleased;
	if( r4 == NULL ) hl_null_access();
	r5 = 0;
	r6 = true;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$719ef83_5_17;
	hl_types_ArrayObj___expand(r4,r5);
	label$719ef83_5_17:
	r9 = r4->array;
	r10 = hl_alloc_dynbool(r6);
	((vdynamic**)(r9 + 1))[r5] = r10;
	r0->x = r1;
	r0->y = r2;
	r0->pressure = r3;
	return;
}

void iron_system_Pen_moveListener(iron__system__Pen r0,int r1,int r2,double r3) {
	bool r7;
	double r5, r6;
	r5 = r0->lastX;
	r6 = -1.;
	if( r5 != r6 ) goto label$719ef83_6_10;
	r5 = r0->lastY;
	r6 = -1.;
	if( r5 != r6 ) goto label$719ef83_6_10;
	r5 = (double)r1;
	r0->lastX = r5;
	r5 = (double)r2;
	r0->lastY = r5;
	label$719ef83_6_10:
	r5 = (double)r1;
	r6 = r0->lastX;
	r5 = r5 - r6;
	r0->movementX = r5;
	r5 = (double)r2;
	r6 = r0->lastY;
	r5 = r5 - r6;
	r0->movementY = r5;
	r5 = (double)r1;
	r0->lastX = r5;
	r5 = (double)r2;
	r0->lastY = r5;
	r5 = (double)r1;
	r0->x = r5;
	r5 = (double)r2;
	r0->y = r5;
	r7 = true;
	r0->moved = r7;
	r0->pressure = r3;
	return;
}

void iron_system_Pen_new(iron__system__Pen r0) {
	hl__types__ArrayObj r3;
	hl_type *r5;
	bool r2;
	vclosure *r11, *r12, *r13, *r14;
	kha__input__Pen r9;
	double r1;
	int *r10;
	vdynamic *r7;
	int r6;
	varray *r4;
	r1 = -1.;
	r0->lastY = r1;
	r1 = -1.;
	r0->lastX = r1;
	r1 = 0.;
	r0->pressure = r1;
	r1 = 0.;
	r0->movementY = r1;
	r1 = 0.;
	r0->movementX = r1;
	r2 = false;
	r0->moved = r2;
	r1 = 0.;
	r0->y = r1;
	r1 = 0.;
	r0->x = r1;
	r5 = &$t_dyn;
	r6 = 1;
	r4 = hl_alloc_array(r5,r6);
	r2 = false;
	r7 = hl_alloc_dynbool(r2);
	r6 = 0;
	((vdynamic**)(r4 + 1))[r6] = r7;
	r3 = hl_types_ArrayObj_alloc(r4);
	r0->buttonsReleased = r3;
	r5 = &$t_dyn;
	r6 = 1;
	r4 = hl_alloc_array(r5,r6);
	r2 = false;
	r7 = hl_alloc_dynbool(r2);
	r6 = 0;
	((vdynamic**)(r4 + 1))[r6] = r7;
	r3 = hl_types_ArrayObj_alloc(r4);
	r0->buttonsStarted = r3;
	r5 = &$t_dyn;
	r6 = 1;
	r4 = hl_alloc_array(r5,r6);
	r2 = false;
	r7 = hl_alloc_dynbool(r2);
	r6 = 0;
	((vdynamic**)(r4 + 1))[r6] = r7;
	r3 = hl_types_ArrayObj_alloc(r4);
	r0->buttonsDown = r3;
	iron_system_VirtualInput_new(((iron__system__VirtualInput)r0));
	r10 = NULL;
	r9 = kha_input_Pen_get(r10);
	if( r9 == NULL ) hl_null_access();
	r11 = hl_alloc_closure_ptr(&$t_fun_7ee9d30,iron_system_Pen_downListener,r0);
	if( r11 ) goto label$719ef83_7_51;
	r12 = NULL;
	goto label$719ef83_7_52;
	label$719ef83_7_51:
	r12 = hl_alloc_closure_ptr(&$t_fun_e927665,iron_system_Pen_new__$1,r11);
	label$719ef83_7_52:
	r11 = hl_alloc_closure_ptr(&$t_fun_7ee9d30,iron_system_Pen_upListener,r0);
	if( r11 ) goto label$719ef83_7_56;
	r13 = NULL;
	goto label$719ef83_7_57;
	label$719ef83_7_56:
	r13 = hl_alloc_closure_ptr(&$t_fun_e927665,iron_system_Pen_new__$1,r11);
	label$719ef83_7_57:
	r14 = hl_alloc_closure_ptr(&$t_fun_792a745,iron_system_Pen_moveListener,r0);
	kha_input_Pen_notify(r9,r12,r13,r14);
	return;
}

