// Generated by HLC 4.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/data/MeshData.h>
#include <iron/data/TSkin.h>
#include <kha/arrays/Int16ArrayPrivate.h>
#include <hl/types/ArrayObj.h>
#include <kha/arrays/Float32ArrayPrivate.h>
void iron_data_Geometry_initSkeletonTransforms(iron__data__Geometry,hl__types__ArrayObj);
#include <hl/types/ArrayDyn.h>
#include <haxe/Log.h>
iron__data__TMeshData iron_data_Data_getMeshRawByName(hl__types__ArrayObj,String);
extern haxe__$Log $g__haxe_Log;
extern String $s_Mesh_data_;
String String___add__(String,String);
extern String $s__not_found_;
extern hl_type $t_vrt_329ffa8;
extern String $s_Sources_iron_data_MeshData_hx;
extern hl_type $t_String;
extern hl_type $t_i32;
extern String $s_iron_data_MeshData;
extern String $s_parse;
extern hl_type $t_vrt_eaa6a3b;
extern hl_type $t_iron_data_MeshData;
extern hl_type $t_ctx_4c331a2;
extern hl_type $t_fun_ad891d9;
void iron_data_MeshData_new(iron__data__MeshData,iron__data__TMeshData,vclosure*);
extern hl_type $t_ctx_bea635b;
extern hl_type $t_fun_df204e4;
void iron_data_Data_getSceneRaw(String,vclosure*);
#include <iron/data/TVertexArray.h>
int String___compare(String,vdynamic*);
#include <hl/types/ArrayBytes_Int.h>
#include <iron/data/TIndexArray.h>
#include <kha/arrays/Uint32ArrayPrivate.h>
extern hl_type $t_kha_arrays_Uint32ArrayPrivate;
#include <hl/natives.h>
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
hl__types__ArrayBytes_Int hl_types_ArrayBase_allocI32(vbyte*,int);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
int hl_types_ArrayBytes_Int_push(hl__types__ArrayBytes_Int,int);
extern String $s_pos;
extern String $s_nor;
extern String $s_tex;
extern String $s_tex1;
extern String $s_col;
extern String $s_tang;
extern hl_type $t_kha_arrays_Int16ArrayPrivate;
void kha_arrays_Int16ArrayPrivate_new(kha__arrays__Int16ArrayPrivate);
extern hl_type $t_iron_data_Geometry;
void iron_data_Geometry_new(iron__data__Geometry,iron__data__MeshData,hl__types__ArrayObj,hl__types__ArrayBytes_Int,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,kha__arrays__Int16ArrayPrivate,vdynamic*);

void iron_data_MeshData_parse__$2(venum* r0,iron__data__MeshData r1) {
	iron__data__Geometry r6;
	kha__arrays__Int16ArrayPrivate r7;
	hl__types__ArrayObj r8;
	iron__data__TSkin r4;
	iron__data__TSceneFormat r2;
	kha__arrays__Float32ArrayPrivate r9;
	vclosure *r10;
	iron__data__TMeshData r5;
	if( r1 == NULL ) hl_null_access();
	r2 = ((Enum$t_ctx_4c331a2*)r0)->p1;
	r1->format = r2;
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( !r4 ) goto label$042282e_1_55;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->bone_count_array;
	r6->skinBoneCounts = r7;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->bone_index_array;
	r6->skinBoneIndices = r7;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->bone_weight_array;
	r6->skinBoneWeights = r7;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r8 = r4->bone_ref_array;
	r6->skeletonBoneRefs = r8;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r9 = r4->bone_len_array;
	r6->skeletonBoneLens = r9;
	r6 = r1->geom;
	if( r6 == NULL ) hl_null_access();
	r5 = ((Enum$t_ctx_4c331a2*)r0)->p2;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->skin;
	if( r4 == NULL ) hl_null_access();
	r8 = r4->transformsI;
	iron_data_Geometry_initSkeletonTransforms(r6,r8);
	label$042282e_1_55:
	r10 = ((Enum$t_ctx_4c331a2*)r0)->p0;
	if( r10 == NULL ) hl_null_access();
	r10->hasValue ? ((void (*)(vdynamic*,iron__data__MeshData))r10->fun)((vdynamic*)r10->value,r1) : ((void (*)(iron__data__MeshData))r10->fun)(r1);
	return;
}

void iron_data_MeshData_parse__$1(venum* r0,iron__data__TSceneFormat r1) {
	String r4, r8;
	vvirtual *r9, *r11;
	hl__types__ArrayObj r3;
	venum *r14;
	haxe__$Log r7;
	iron__data__MeshData r13;
	vclosure *r6, *r12;
	iron__data__TMeshData r2;
	int r10;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->mesh_datas;
	r4 = ((Enum$t_ctx_bea635b*)r0)->p0;
	r2 = iron_data_Data_getMeshRawByName(r3,r4);
	if( r2 ) goto label$042282e_2_28;
	r7 = (haxe__$Log)$g__haxe_Log;
	r6 = r7->trace;
	if( r6 == NULL ) hl_null_access();
	r4 = (String)$s_Mesh_data_;
	r8 = ((Enum$t_ctx_bea635b*)r0)->p0;
	r4 = String___add__(r4,r8);
	r8 = (String)$s__not_found_;
	r4 = String___add__(r4,r8);
	r9 = hl_alloc_virtual(&$t_vrt_329ffa8);
	r8 = (String)$s_Sources_iron_data_MeshData_hx;
	if( hl_vfields(r9)[1] ) *(String*)(hl_vfields(r9)[1]) = (String)r8; else hl_dyn_setp(r9->value,37969014/*fileName*/,&$t_String,r8);
	r10 = 96;
	if( hl_vfields(r9)[2] ) *(int*)(hl_vfields(r9)[2]) = (int)r10; else hl_dyn_seti(r9->value,371360620/*lineNumber*/,&$t_i32,r10);
	r8 = (String)$s_iron_data_MeshData;
	if( hl_vfields(r9)[0] ) *(String*)(hl_vfields(r9)[0]) = (String)r8; else hl_dyn_setp(r9->value,-63073762/*className*/,&$t_String,r8);
	r8 = (String)$s_parse;
	if( hl_vfields(r9)[3] ) *(String*)(hl_vfields(r9)[3]) = (String)r8; else hl_dyn_setp(r9->value,302979532/*methodName*/,&$t_String,r8);
	r11 = hl_to_virtual(&$t_vrt_eaa6a3b,(vdynamic*)r9);
	r6->hasValue ? ((void (*)(vdynamic*,vdynamic*,vvirtual*))r6->fun)((vdynamic*)r6->value,((vdynamic*)r4),r11) : ((void (*)(vdynamic*,vvirtual*))r6->fun)(((vdynamic*)r4),r11);
	r12 = ((Enum$t_ctx_bea635b*)r0)->p1;
	if( r12 == NULL ) hl_null_access();
	r13 = NULL;
	r12->hasValue ? ((void (*)(vdynamic*,iron__data__MeshData))r12->fun)((vdynamic*)r12->value,r13) : ((void (*)(iron__data__MeshData))r12->fun)(r13);
	label$042282e_2_28:
	r13 = (iron__data__MeshData)hl_alloc_obj(&$t_iron_data_MeshData);
	r14 = hl_alloc_enum(&$t_ctx_4c331a2,0);
	r12 = ((Enum$t_ctx_bea635b*)r0)->p1;
	((Enum$t_ctx_4c331a2*)r14)->p0 = (vclosure*)r12;
	((Enum$t_ctx_4c331a2*)r14)->p1 = (iron__data__TSceneFormat)r1;
	((Enum$t_ctx_4c331a2*)r14)->p2 = (iron__data__TMeshData)r2;
	r12 = hl_alloc_closure_ptr(&$t_fun_ad891d9,iron_data_MeshData_parse__$2,r14);
	iron_data_MeshData_new(r13,r2,r12);
	return;
}

void iron_data_MeshData_parse(String r0,String r1,vclosure* r2) {
	venum *r5;
	vclosure *r4;
	r5 = hl_alloc_enum(&$t_ctx_bea635b,0);
	((Enum$t_ctx_bea635b*)r5)->p0 = (String)r1;
	((Enum$t_ctx_bea635b*)r5)->p1 = (vclosure*)r2;
	r4 = hl_alloc_closure_ptr(&$t_fun_df204e4,iron_data_MeshData_parse__$1,r5);
	iron_data_Data_getSceneRaw(r0,r4);
	return;
}

kha__arrays__Int16ArrayPrivate iron_data_MeshData_getVertexArrayValues(iron__data__MeshData r0,String r1) {
	String r9;
	kha__arrays__Int16ArrayPrivate r10;
	hl__types__ArrayObj r3;
	iron__data__TVertexArray r6;
	iron__data__TMeshData r4;
	vdynamic *r7;
	varray *r8;
	int r2, r5;
	r2 = 0;
	r4 = r0->raw;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->vertex_arrays;
	label$042282e_4_4:
	if( r3 == NULL ) hl_null_access();
	r5 = r3->length;
	if( r2 >= r5 ) goto label$042282e_4_22;
	r5 = r3->length;
	if( ((unsigned)r2) < ((unsigned)r5) ) goto label$042282e_4_12;
	r6 = NULL;
	goto label$042282e_4_15;
	label$042282e_4_12:
	r8 = r3->array;
	r7 = ((vdynamic**)(r8 + 1))[r2];
	r6 = (iron__data__TVertexArray)r7;
	label$042282e_4_15:
	++r2;
	if( r6 == NULL ) hl_null_access();
	r9 = r6->attrib;
	if( r9 != r1 && (!r9 || !r1 || String___compare(r9,(vdynamic*)r1) != 0) ) goto label$042282e_4_21;
	r10 = r6->values;
	return r10;
	label$042282e_4_21:
	goto label$042282e_4_4;
	label$042282e_4_22:
	r10 = NULL;
	return r10;
}

void iron_data_MeshData_new(iron__data__MeshData r0,iron__data__TMeshData r1,vclosure* r2) {
	iron__data__Geometry r49;
	String r6;
	kha__arrays__Int16ArrayPrivate r20, r21, r22, r23, r24, r25, r31, r32, r33, r36, r38;
	iron__data__TIndexArray r17;
	hl__types__ArrayObj r9, r14;
	hl_type *r11;
	bool r26;
	hl__types__ArrayBytes_Int r12;
	iron__data__TSkin r27, r28;
	float r4;
	kha__arrays__Uint32ArrayPrivate r19;
	double r3, r34, r41;
	vdynamic *r8, *r18, *r29, *r30, *r50;
	vbyte *r13;
	varray *r10;
	int r5, r15, r16, r35, r37, r39, r40, r42, r43, r44, r45, r46, r47, r48;
	r3 = 1.;
	r4 = (float)r3;
	r0->scaleTex = r4;
	r3 = 1.;
	r4 = (float)r3;
	r0->scalePos = r4;
	r5 = 0;
	r0->refcount = r5;
	r0->raw = r1;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->name;
	r0->name = r6;
	r8 = r1->scale_pos;
	if( !r8 ) goto label$042282e_5_17;
	r8 = r1->scale_pos;
	r4 = r8 ? r8->v.f : 0;
	r0->scalePos = r4;
	label$042282e_5_17:
	r8 = r1->scale_tex;
	if( !r8 ) goto label$042282e_5_22;
	r8 = r1->scale_tex;
	r4 = r8 ? r8->v.f : 0;
	r0->scaleTex = r4;
	label$042282e_5_22:
	r11 = &$t_kha_arrays_Uint32ArrayPrivate;
	r5 = 0;
	r10 = hl_alloc_array(r11,r5);
	r9 = hl_types_ArrayObj_alloc(r10);
	r5 = 0;
	r13 = hl_alloc_bytes(r5);
	r5 = 0;
	r5 = 0;
	r12 = hl_types_ArrayBase_allocI32(r13,r5);
	r5 = 0;
	r14 = r1->index_arrays;
	label$042282e_5_33:
	if( r14 == NULL ) hl_null_access();
	r16 = r14->length;
	if( r5 >= r16 ) goto label$042282e_5_53;
	r16 = r14->length;
	if( ((unsigned)r5) < ((unsigned)r16) ) goto label$042282e_5_41;
	r17 = NULL;
	goto label$042282e_5_44;
	label$042282e_5_41:
	r10 = r14->array;
	r18 = ((vdynamic**)(r10 + 1))[r5];
	r17 = (iron__data__TIndexArray)r18;
	label$042282e_5_44:
	++r5;
	if( r9 == NULL ) hl_null_access();
	if( r17 == NULL ) hl_null_access();
	r19 = r17->values;
	r15 = hl_types_ArrayObj_push(r9,((vdynamic*)r19));
	if( r12 == NULL ) hl_null_access();
	r15 = r17->material;
	r15 = hl_types_ArrayBytes_Int_push(r12,r15);
	goto label$042282e_5_33;
	label$042282e_5_53:
	r6 = (String)$s_pos;
	r20 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	r6 = (String)$s_nor;
	r21 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	r6 = (String)$s_tex;
	r22 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	r6 = (String)$s_tex1;
	r23 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	r6 = (String)$s_col;
	r24 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	r6 = (String)$s_tang;
	r25 = iron_data_MeshData_getVertexArrayValues(r0,r6);
	if( r1 == NULL ) hl_null_access();
	r27 = r1->skin;
	r28 = NULL;
	if( r27 != r28 ) goto label$042282e_5_71;
	r26 = false;
	goto label$042282e_5_72;
	label$042282e_5_71:
	r26 = true;
	label$042282e_5_72:
	r0->isSkinned = r26;
	r5 = 0;
	r29 = r1->dynamic_usage;
	if( !r29 ) goto label$042282e_5_82;
	r29 = r1->dynamic_usage;
	r26 = true;
	r30 = hl_alloc_dynbool(r26);
	if( r29 != r30 && (!r29 || !r30 || (r29->v.b != r30->v.b)) ) goto label$042282e_5_82;
	r15 = 1;
	r5 = r15;
	label$042282e_5_82:
	r15 = r5;
	r31 = NULL;
	r32 = NULL;
	r26 = r0->isSkinned;
	if( !r26 ) goto label$042282e_5_175;
	if( r20 == NULL ) hl_null_access();
	r16 = r20->length;
	r3 = (double)r16;
	r34 = 4.;
	r3 = r3 / r34;
	r16 = (int)r3;
	r35 = 4;
	r16 = r16 * r35;
	r33 = (kha__arrays__Int16ArrayPrivate)hl_alloc_obj(&$t_kha_arrays_Int16ArrayPrivate);
	kha_arrays_Int16ArrayPrivate_new(r33);
	r33->length = r16;
	r37 = 0;
	if( r37 >= r16 ) goto label$042282e_5_102;
	r13 = hl_kore_int16array_alloc(r16);
	r33->self = r13;
	label$042282e_5_102:
	r31 = r33;
	r36 = (kha__arrays__Int16ArrayPrivate)hl_alloc_obj(&$t_kha_arrays_Int16ArrayPrivate);
	kha_arrays_Int16ArrayPrivate_new(r36);
	r36->length = r16;
	r37 = 0;
	if( r37 >= r16 ) goto label$042282e_5_110;
	r13 = hl_kore_int16array_alloc(r16);
	r36->self = r13;
	label$042282e_5_110:
	r32 = r36;
	r35 = 0;
	r37 = 0;
	r39 = 0;
	r40 = r20->length;
	r34 = (double)r40;
	r41 = 4.;
	r34 = r34 / r41;
	r40 = (int)r34;
	label$042282e_5_119:
	if( r39 >= r40 ) goto label$042282e_5_175;
	r42 = r39;
	++r39;
	if( r1 == NULL ) hl_null_access();
	r27 = r1->skin;
	if( r27 == NULL ) hl_null_access();
	r38 = r27->bone_count_array;
	if( r38 == NULL ) hl_null_access();
	r13 = r38->self;
	r43 = hl_kore_int16array_get(r13,r42);
	r44 = r35;
	r45 = r35 + r43;
	label$042282e_5_132:
	if( r44 >= r45 ) goto label$042282e_5_157;
	r46 = r44;
	++r44;
	if( r1 == NULL ) hl_null_access();
	r27 = r1->skin;
	if( r27 == NULL ) hl_null_access();
	r38 = r27->bone_index_array;
	if( r38 == NULL ) hl_null_access();
	r13 = r38->self;
	r47 = hl_kore_int16array_get(r13,r46);
	if( r31 == NULL ) hl_null_access();
	r13 = r31->self;
	hl_kore_int16array_set(r13,r37,r47);
	r27 = r1->skin;
	if( r27 == NULL ) hl_null_access();
	r38 = r27->bone_weight_array;
	if( r38 == NULL ) hl_null_access();
	r13 = r38->self;
	r47 = hl_kore_int16array_get(r13,r46);
	if( r32 == NULL ) hl_null_access();
	r13 = r32->self;
	hl_kore_int16array_set(r13,r37,r47);
	++r37;
	goto label$042282e_5_132;
	label$042282e_5_157:
	r44 = r43;
	r45 = 4;
	label$042282e_5_159:
	if( r44 >= r45 ) goto label$042282e_5_172;
	++r44;
	if( r31 == NULL ) hl_null_access();
	r13 = r31->self;
	r48 = 0;
	hl_kore_int16array_set(r13,r37,r48);
	if( r32 == NULL ) hl_null_access();
	r13 = r32->self;
	r48 = 0;
	hl_kore_int16array_set(r13,r37,r48);
	++r37;
	goto label$042282e_5_159;
	label$042282e_5_172:
	r44 = r35 + r43;
	r35 = r44;
	goto label$042282e_5_119;
	label$042282e_5_175:
	r49 = (iron__data__Geometry)hl_alloc_obj(&$t_iron_data_Geometry);
	r50 = hl_alloc_dynamic(&$t_i32);
	r50->v.i = r15;
	iron_data_Geometry_new(r49,r0,r9,r12,r20,r21,r22,r23,r24,r25,r31,r32,r50);
	r0->geom = r49;
	r49 = r0->geom;
	if( r49 == NULL ) hl_null_access();
	r6 = r0->name;
	r49->name = r6;
	if( r2 == NULL ) hl_null_access();
	r2->hasValue ? ((void (*)(vdynamic*,iron__data__MeshData))r2->fun)((vdynamic*)r2->value,r0) : ((void (*)(iron__data__MeshData))r2->fun)(r0);
	return;
}

