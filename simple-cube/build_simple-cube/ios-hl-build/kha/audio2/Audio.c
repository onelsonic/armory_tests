// Generated by HLC 4.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <kha/audio2/Audio.h>
extern hl_type $t_kha_audio2_Buffer;
void kha_audio2_Buffer_new(kha__audio2__Buffer,int,int,int);
extern kha__audio2__$Audio $g__kha_audio2_Audio;
#include <kha/arrays/Float32ArrayPrivate.h>
#include <hl/natives.h>

void kha_audio2_Audio__init() {
	kha__audio2__$Audio r6;
	kha__audio2__Buffer r2;
	int r0, r3, r4, r5;
	r0 = 2048;
	r2 = (kha__audio2__Buffer)hl_alloc_obj(&$t_kha_audio2_Buffer);
	r4 = 4;
	r3 = r0 * r4;
	r4 = 2;
	r5 = 44100;
	kha_audio2_Buffer_new(r2,r3,r4,r5);
	r6 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r6->buffer = r2;
	return;
}

void kha_audio2_Audio__callCallback(int r0) {
	kha__audio2__$Audio r3;
	kha__audio2__Buffer r2;
	float r11;
	kha__arrays__Float32ArrayPrivate r9;
	vclosure *r4;
	vbyte *r8;
	int r5, r6, r7, r10;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 ) goto label$6ed06f1_2_4;
	return;
	label$6ed06f1_2_4:
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r4 = r3->audioCallback;
	if( !r4 ) goto label$6ed06f1_2_14;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r4 = r3->audioCallback;
	if( r4 == NULL ) hl_null_access();
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	r4->hasValue ? ((void (*)(vdynamic*,int,kha__audio2__Buffer))r4->fun)((vdynamic*)r4->value,r0,r2) : ((void (*)(int,kha__audio2__Buffer))r4->fun)(r0,r2);
	goto label$6ed06f1_2_54;
	label$6ed06f1_2_14:
	r5 = 0;
	r6 = r0;
	label$6ed06f1_2_16:
	if( r5 >= r6 ) goto label$6ed06f1_2_54;
	++r5;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r9 = r2->data;
	if( r9 == NULL ) hl_null_access();
	r8 = r9->self;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r7 = r2->writeLocation;
	r10 = 0;
	r11 = (float)r10;
	hl_kore_float32array_set(r8,r7,r11);
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r7 = r2->writeLocation;
	r10 = 1;
	r7 = r7 + r10;
	r2->writeLocation = r7;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r7 = r2->writeLocation;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r10 = r2->size;
	if( r7 < r10 ) goto label$6ed06f1_2_53;
	r3 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r2 = r3->buffer;
	if( r2 == NULL ) hl_null_access();
	r7 = 0;
	r2->writeLocation = r7;
	label$6ed06f1_2_53:
	goto label$6ed06f1_2_16;
	label$6ed06f1_2_54:
	return;
}

float kha_audio2_Audio__readSample() {
	kha__audio2__$Audio r1;
	kha__audio2__Buffer r0;
	kha__arrays__Float32ArrayPrivate r5;
	float r3;
	vbyte *r4;
	int r2, r6;
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 ) goto label$6ed06f1_3_6;
	r2 = 0;
	r3 = (float)r2;
	return r3;
	label$6ed06f1_3_6:
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r5 = r0->data;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->self;
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r2 = r0->readLocation;
	r3 = hl_kore_float32array_get(r4,r2);
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r2 = r0->readLocation;
	++r2;
	r0->readLocation = r2;
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r2 = r0->readLocation;
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r6 = r0->size;
	if( r2 < r6 ) goto label$6ed06f1_3_37;
	r1 = (kha__audio2__$Audio)$g__kha_audio2_Audio;
	r0 = r1->buffer;
	if( r0 == NULL ) hl_null_access();
	r2 = 0;
	r0->readLocation = r2;
	label$6ed06f1_3_37:
	return r3;
}

vvirtual* kha_audio2_Audio_stream(kha__Sound r0,bool* r1) {
	vvirtual *r3;
	bool r2;
	if( r1 ) goto label$6ed06f1_4_3;
	r2 = false;
	goto label$6ed06f1_4_4;
	label$6ed06f1_4_3:
	r2 = *r1;
	label$6ed06f1_4_4:
	r3 = NULL;
	return r3;
}

