// Generated by HLC 4.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/object/ParticleSystem.h>
#include <kha/arrays/Float32ArrayPrivate.h>
#include <iron/data/TSceneFormat.h>
#include <iron/Scene.h>
#include <iron/object/Particle.h>
extern iron__$Scene g$_iron_Scene;
#include <hl/natives.h>
extern hl_type t$iron_object_Particle;
void iron_object_Particle_new(iron__object__Particle,int);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
#include <iron/object/MeshObject.h>
#include <iron/object/Transform.h>
#include <iron/math/Vec4.h>
#include <iron/math/Quat.h>
#include <iron/object/Tilesheet.h>
#include <iron/data/TTilesheetData.h>
#include <iron/system/Time.h>
void iron_object_Transform_buildMatrix(iron__object__Transform);
extern iron__system__$Time g$_iron_system_Time;
void iron_object_ParticleSystem_updateGpu(iron__object__ParticleSystem,iron__object__MeshObject,iron__object__MeshObject);
#include <kha/math/FastMatrix4.h>
#include <iron/data/Geometry.h>
#include <iron/data/MeshData.h>
void iron_object_ParticleSystem_setupGeomGpu(iron__object__ParticleSystem,iron__object__MeshObject,iron__object__MeshObject);
#include <kha/arrays/Int16ArrayPrivate.h>
extern hl_type t$kha_arrays_Float32ArrayPrivate;
void kha_arrays_Float32ArrayPrivate_new(kha__arrays__Float32ArrayPrivate);
double iron_object_ParticleSystem_fhash(iron__object__ParticleSystem,int);
double Math_random(void);
void iron_data_Geometry_applyScale(iron__data__Geometry,double,double,double);
void iron_data_Geometry_setupInstanced(iron__data__Geometry,kha__arrays__Float32ArrayPrivate,int,int);
#include <iron/data/TParticleReference.h>
extern hl_type t$iron_math_Mat4;
void iron_math_Mat4_new(iron__math__Mat4,float,float,float,float,float,float,float,float,float,float,float,float,float,float,float,float);
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern hl_type t$fun_9cbeb3a;
void iron_data_Data_getParticle(String,String,vclosure*);

void iron_object_ParticleSystem_new__$1(iron__object__ParticleSystem r0,iron__data__ParticleData r1) {
	hl__types__ArrayObj r21;
	bool r23;
	iron__$Scene r8;
	iron__Scene r7;
	iron__data__ParticleData r2;
	iron__object__Particle r22;
	iron__data__TParticleData r3;
	iron__data__TSceneFormat r6;
	float r9, r12, r13, r15, r16;
	kha__arrays__Float32ArrayPrivate r5;
	double r14, r17;
	int r11, r18, r19, r20;
	vbyte *r10;
	if( r0 == NULL ) hl_null_access();
	r0->data = r1;
	r2 = r0->data;
	if( r2 == NULL ) hl_null_access();
	r3 = r2->raw;
	r0->r = r3;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( !r5 ) goto label$f408df5_1_62;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 0;
	r9 = hl_kore_float32array_get(r10,r11);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r13 = r3->weight_gravity;
	r12 = r9 * r13;
	r14 = (double)r12;
	r0->gx = r14;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 1;
	r12 = hl_kore_float32array_get(r10,r11);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r15 = r3->weight_gravity;
	r13 = r12 * r15;
	r14 = (double)r13;
	r0->gy = r14;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 2;
	r13 = hl_kore_float32array_get(r10,r11);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r16 = r3->weight_gravity;
	r15 = r13 * r16;
	r14 = (double)r15;
	r0->gz = r14;
	goto label$f408df5_1_73;
	label$f408df5_1_62:
	r14 = 0.;
	r0->gx = r14;
	r14 = 0.;
	r0->gy = r14;
	r14 = -9.8100000000000005;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r9 = r3->weight_gravity;
	r17 = (double)r9;
	r14 = r14 * r17;
	r0->gz = r14;
	label$f408df5_1_73:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->object_align_factor;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 0;
	r9 = hl_kore_float32array_get(r10,r11);
	r14 = (double)r9;
	r17 = 2.;
	r14 = r14 / r17;
	r0->alignx = r14;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->object_align_factor;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 1;
	r12 = hl_kore_float32array_get(r10,r11);
	r14 = (double)r12;
	r17 = 2.;
	r14 = r14 / r17;
	r0->aligny = r14;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->object_align_factor;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r11 = 2;
	r13 = hl_kore_float32array_get(r10,r11);
	r14 = (double)r13;
	r17 = 2.;
	r14 = r14 / r17;
	r0->alignz = r14;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r15 = r3->lifetime;
	r14 = (double)r15;
	r11 = r0->frameRate;
	r17 = (double)r11;
	r14 = r14 / r17;
	r0->lifetime = r14;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r15 = r3->frame_end;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r16 = r3->frame_start;
	r15 = r15 - r16;
	r14 = (double)r15;
	r11 = r0->frameRate;
	r17 = (double)r11;
	r14 = r14 / r17;
	r0->animtime = r14;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r15 = r3->frame_end;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r16 = r3->frame_start;
	r15 = r15 - r16;
	r14 = (double)r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r11 = r3->count;
	r17 = (double)r11;
	r14 = r14 / r17;
	r11 = r0->frameRate;
	r17 = (double)r11;
	r14 = r14 / r17;
	r0->spawnRate = r14;
	r11 = 0;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r18 = r3->count;
	label$f408df5_1_147:
	if( r11 >= r18 ) goto label$f408df5_1_158;
	r19 = r11;
	++r11;
	if( r0 == NULL ) hl_null_access();
	r21 = r0->particles;
	if( r21 == NULL ) hl_null_access();
	r22 = (iron__object__Particle)hl_alloc_obj(&t$iron_object_Particle);
	iron_object_Particle_new(r22,r19);
	r20 = hl_types_ArrayObj_push(r21,((vdynamic*)r22));
	goto label$f408df5_1_147;
	label$f408df5_1_158:
	if( r0 == NULL ) hl_null_access();
	r23 = true;
	r0->ready = r23;
	return;
}

void iron_object_ParticleSystem_update(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__TTilesheetData r15;
	iron__math__Quat r10;
	bool r4;
	iron__math__Vec4 r8, r11;
	iron__object__Transform r7, r9;
	iron__object__Tilesheet r13;
	float r12;
	double r5, r6, r17, r18;
	iron__system__$Time r16;
	int r14;
	r4 = r0->ready;
	if( !r4 ) goto label$f408df5_2_6;
	if( !r1 ) goto label$f408df5_2_6;
	r5 = r0->speed;
	r6 = 0.;
	if( r5 != r6 ) goto label$f408df5_2_7;
	label$f408df5_2_6:
	return;
	label$f408df5_2_7:
	if( r1 == NULL ) hl_null_access();
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	if( r2 == NULL ) hl_null_access();
	r9 = r2->transform;
	if( r9 == NULL ) hl_null_access();
	r8 = r9->loc;
	r7->loc = r8;
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	r9 = r2->transform;
	if( r9 == NULL ) hl_null_access();
	r10 = r9->rot;
	r7->rot = r10;
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	iron_object_Transform_buildMatrix(r7);
	r7 = r2->transform;
	if( r7 == NULL ) hl_null_access();
	iron_object_Transform_buildMatrix(r7);
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	r8 = r7->dim;
	r7 = r2->transform;
	if( r7 == NULL ) hl_null_access();
	r11 = r7->dim;
	if( r8 == NULL ) hl_null_access();
	if( r11 == NULL ) hl_null_access();
	r12 = r11->x;
	r8->x = r12;
	r12 = r11->y;
	r8->y = r12;
	r12 = r11->z;
	r8->z = r12;
	r12 = r11->w;
	r8->w = r12;
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	r8 = r7->dim;
	if( r8 == NULL ) hl_null_access();
	r12 = r8->x;
	r5 = (double)r12;
	r0->dimx = r5;
	r7 = r1->transform;
	if( r7 == NULL ) hl_null_access();
	r8 = r7->dim;
	if( r8 == NULL ) hl_null_access();
	r12 = r8->y;
	r5 = (double)r12;
	r0->dimy = r5;
	r13 = r1->tilesheet;
	if( !r13 ) goto label$f408df5_2_77;
	r13 = r1->tilesheet;
	if( r13 == NULL ) hl_null_access();
	r15 = r13->raw;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->tilesx;
	r0->tilesx = r14;
	r13 = r1->tilesheet;
	if( r13 == NULL ) hl_null_access();
	r15 = r13->raw;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->tilesy;
	r0->tilesy = r14;
	r13 = r1->tilesheet;
	if( r13 == NULL ) hl_null_access();
	r15 = r13->raw;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->framerate;
	r0->tilesFramerate = r14;
	label$f408df5_2_77:
	r5 = r0->time;
	r16 = (iron__system__$Time)g$_iron_system_Time;
	r6 = r16->realDelta;
	r17 = r0->speed;
	r6 = r6 * r17;
	r5 = r5 + r6;
	r0->time = r5;
	r5 = r0->time;
	r6 = r0->animtime;
	r5 = r5 / r6;
	r14 = (int)r5;
	r0->lap = r14;
	r6 = r0->time;
	r14 = r0->lap;
	r17 = (double)r14;
	r18 = r0->animtime;
	r17 = r17 * r18;
	r6 = r6 - r17;
	r0->lapTime = r6;
	r6 = r0->lapTime;
	r17 = r0->spawnRate;
	r6 = r6 / r17;
	r14 = (int)r6;
	r0->count = r14;
	iron_object_ParticleSystem_updateGpu(r0,r1,r2);
	return;
}

iron__math__Mat4 iron_object_ParticleSystem_getData(iron__object__ParticleSystem r0) {
	hl__types__ArrayObj r10;
	kha__math__FastMatrix4 r5;
	bool r1, r8;
	iron__data__TParticleData r3;
	float r7;
	iron__math__Mat4 r6;
	double r9, r11;
	int r2, r4;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->type;
	r4 = 1;
	if( r2 == r4 ) goto label$f408df5_3_7;
	r1 = false;
	goto label$f408df5_3_8;
	label$f408df5_3_7:
	r1 = true;
	label$f408df5_3_8:
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r8 = r3->loop;
	if( !r8 ) goto label$f408df5_3_19;
	r9 = r0->animtime;
	r7 = (float)r9;
	goto label$f408df5_3_22;
	label$f408df5_3_19:
	r9 = r0->animtime;
	r9 = -r9;
	r7 = (float)r9;
	label$f408df5_3_22:
	r5->_00 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_36;
	r9 = 1.;
	r10 = r0->particles;
	if( r10 == NULL ) hl_null_access();
	r2 = r10->length;
	r11 = (double)r2;
	r9 = r9 / r11;
	r7 = (float)r9;
	goto label$f408df5_3_38;
	label$f408df5_3_36:
	r9 = r0->spawnRate;
	r7 = (float)r9;
	label$f408df5_3_38:
	r5->_01 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_47;
	r2 = 1;
	r7 = (float)r2;
	goto label$f408df5_3_49;
	label$f408df5_3_47:
	r9 = r0->lifetime;
	r7 = (float)r9;
	label$f408df5_3_49:
	r5->_02 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r10 = r0->particles;
	if( r10 == NULL ) hl_null_access();
	r2 = r10->length;
	r7 = (float)r2;
	r5->_03 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_67;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_69;
	label$f408df5_3_67:
	r9 = r0->alignx;
	r7 = (float)r9;
	label$f408df5_3_69:
	r5->_10 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_78;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_80;
	label$f408df5_3_78:
	r9 = r0->aligny;
	r7 = (float)r9;
	label$f408df5_3_80:
	r5->_11 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_89;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_91;
	label$f408df5_3_89:
	r9 = r0->alignz;
	r7 = (float)r9;
	label$f408df5_3_91:
	r5->_12 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_100;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_103;
	label$f408df5_3_100:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->factor_random;
	label$f408df5_3_103:
	r5->_13 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_112;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_119;
	label$f408df5_3_112:
	r9 = r0->gx;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_119:
	r5->_20 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_128;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_135;
	label$f408df5_3_128:
	r9 = r0->gy;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_135:
	r5->_21 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_144;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_151;
	label$f408df5_3_144:
	r9 = r0->gz;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_151:
	r5->_22 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_160;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_163;
	label$f408df5_3_160:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->lifetime_random;
	label$f408df5_3_163:
	r5->_23 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r2 = r0->tilesx;
	r7 = (float)r2;
	r5->_30 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r2 = r0->tilesy;
	r7 = (float)r2;
	r5->_31 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r9 = 1.;
	r2 = r0->tilesFramerate;
	r11 = (double)r2;
	r9 = r9 / r11;
	r7 = (float)r9;
	r5->_32 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_196;
	r2 = 1;
	r7 = (float)r2;
	goto label$f408df5_3_198;
	label$f408df5_3_196:
	r9 = r0->lapTime;
	r7 = (float)r9;
	label$f408df5_3_198:
	r5->_33 = r7;
	r6 = r0->m;
	return r6;
}

void iron_object_ParticleSystem_updateGpu(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__Geometry r5;
	bool r4;
	iron__data__MeshData r6;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->data;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->geom;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->instanced;
	if( r4 ) goto label$f408df5_4_8;
	iron_object_ParticleSystem_setupGeomGpu(r0,r1,r2);
	label$f408df5_4_8:
	return;
}

void iron_object_ParticleSystem_setupGeomGpu(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__Geometry r14;
	kha__arrays__Int16ArrayPrivate r13;
	hl__types__ArrayObj r4;
	iron__math__Vec4 r26;
	iron__object__Particle r18;
	iron__data__TParticleData r11;
	iron__object__Transform r27;
	iron__data__MeshData r15;
	float r16, r25;
	kha__arrays__Float32ArrayPrivate r7, r8;
	double r21, r22, r23;
	vdynamic *r19;
	varray *r20;
	vbyte *r10;
	int r3, r5, r9, r12, r17, r24;
	r4 = r0->particles;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	r5 = 3;
	r3 = r3 * r5;
	r7 = (kha__arrays__Float32ArrayPrivate)hl_alloc_obj(&t$kha_arrays_Float32ArrayPrivate);
	kha_arrays_Float32ArrayPrivate_new(r7);
	r7->length = r3;
	r9 = 0;
	if( r9 >= r3 ) goto label$f408df5_5_12;
	r10 = hl_kore_float32array_alloc(r3);
	r7->self = r10;
	label$f408df5_5_12:
	r8 = r7;
	r5 = 0;
	r11 = r0->r;
	if( r11 == NULL ) hl_null_access();
	r9 = r11->emit_from;
	r12 = 0;
	if( r9 != r12 ) goto label$f408df5_5_96;
	if( r2 == NULL ) hl_null_access();
	r15 = r2->data;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->geom;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->positions;
	r15 = r2->data;
	if( r15 == NULL ) hl_null_access();
	r16 = r15->scalePos;
	r9 = 0;
	r4 = r0->particles;
	label$f408df5_5_30:
	if( r4 == NULL ) hl_null_access();
	r17 = r4->length;
	if( r9 >= r17 ) goto label$f408df5_5_95;
	r17 = r4->length;
	if( ((unsigned)r9) < ((unsigned)r17) ) goto label$f408df5_5_38;
	r18 = NULL;
	goto label$f408df5_5_41;
	label$f408df5_5_38:
	r20 = r4->array;
	r19 = ((vdynamic**)(r20 + 1))[r9];
	r18 = (iron__object__Particle)r19;
	label$f408df5_5_41:
	++r9;
	r21 = iron_object_ParticleSystem_fhash(r0,r5);
	if( r13 == NULL ) hl_null_access();
	r12 = r13->length;
	r22 = (double)r12;
	r23 = 4.;
	r22 = r22 / r23;
	r21 = r21 * r22;
	r12 = (int)r21;
	r10 = r13->self;
	r24 = 4;
	r17 = r12 * r24;
	r17 = hl_kore_int16array_get(r10,r17);
	r22 = (double)r17;
	r23 = 32767.;
	r22 = r22 / r23;
	r23 = (double)r16;
	r22 = r22 * r23;
	r25 = (float)r22;
	if( r8 == NULL ) hl_null_access();
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r25);
	++r5;
	r10 = r13->self;
	r24 = 4;
	r17 = r12 * r24;
	r24 = 1;
	r17 = r17 + r24;
	r17 = hl_kore_int16array_get(r10,r17);
	r22 = (double)r17;
	r23 = 32767.;
	r22 = r22 / r23;
	r23 = (double)r16;
	r22 = r22 * r23;
	r25 = (float)r22;
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r25);
	++r5;
	r10 = r13->self;
	r24 = 4;
	r17 = r12 * r24;
	r24 = 2;
	r17 = r17 + r24;
	r17 = hl_kore_int16array_get(r10,r17);
	r22 = (double)r17;
	r23 = 32767.;
	r22 = r22 / r23;
	r23 = (double)r16;
	r22 = r22 * r23;
	r25 = (float)r22;
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r25);
	++r5;
	goto label$f408df5_5_30;
	label$f408df5_5_95:
	goto label$f408df5_5_167;
	label$f408df5_5_96:
	r9 = 0;
	r4 = r0->particles;
	label$f408df5_5_98:
	if( r4 == NULL ) hl_null_access();
	r17 = r4->length;
	if( r9 >= r17 ) goto label$f408df5_5_167;
	r17 = r4->length;
	if( ((unsigned)r9) < ((unsigned)r17) ) goto label$f408df5_5_106;
	r18 = NULL;
	goto label$f408df5_5_109;
	label$f408df5_5_106:
	r20 = r4->array;
	r19 = ((vdynamic**)(r20 + 1))[r9];
	r18 = (iron__object__Particle)r19;
	label$f408df5_5_109:
	++r9;
	r21 = Math_random();
	r22 = 2.;
	r21 = r21 * r22;
	r22 = 1.;
	r21 = r21 - r22;
	if( r1 == NULL ) hl_null_access();
	r27 = r1->transform;
	if( r27 == NULL ) hl_null_access();
	r26 = r27->dim;
	if( r26 == NULL ) hl_null_access();
	r16 = r26->x;
	r22 = (double)r16;
	r23 = 2.;
	r22 = r22 / r23;
	r21 = r21 * r22;
	r16 = (float)r21;
	if( r8 == NULL ) hl_null_access();
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r16);
	++r5;
	r21 = Math_random();
	r22 = 2.;
	r21 = r21 * r22;
	r22 = 1.;
	r21 = r21 - r22;
	r27 = r1->transform;
	if( r27 == NULL ) hl_null_access();
	r26 = r27->dim;
	if( r26 == NULL ) hl_null_access();
	r16 = r26->y;
	r22 = (double)r16;
	r23 = 2.;
	r22 = r22 / r23;
	r21 = r21 * r22;
	r16 = (float)r21;
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r16);
	++r5;
	r21 = Math_random();
	r22 = 2.;
	r21 = r21 * r22;
	r22 = 1.;
	r21 = r21 - r22;
	r27 = r1->transform;
	if( r27 == NULL ) hl_null_access();
	r26 = r27->dim;
	if( r26 == NULL ) hl_null_access();
	r16 = r26->z;
	r22 = (double)r16;
	r23 = 2.;
	r22 = r22 / r23;
	r21 = r21 * r22;
	r16 = (float)r21;
	r10 = r8->self;
	hl_kore_float32array_set(r10,r5,r16);
	++r5;
	goto label$f408df5_5_98;
	label$f408df5_5_167:
	r11 = r0->r;
	if( r11 == NULL ) hl_null_access();
	r16 = r11->particle_size;
	r21 = (double)r16;
	r22 = 1.;
	if( r21 == r22 ) goto label$f408df5_5_191;
	if( r1 == NULL ) hl_null_access();
	r15 = r1->data;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->geom;
	if( r14 == NULL ) hl_null_access();
	r11 = r0->r;
	if( r11 == NULL ) hl_null_access();
	r16 = r11->particle_size;
	r21 = (double)r16;
	r11 = r0->r;
	if( r11 == NULL ) hl_null_access();
	r16 = r11->particle_size;
	r22 = (double)r16;
	r11 = r0->r;
	if( r11 == NULL ) hl_null_access();
	r16 = r11->particle_size;
	r23 = (double)r16;
	iron_data_Geometry_applyScale(r14,r21,r22,r23);
	label$f408df5_5_191:
	if( r1 == NULL ) hl_null_access();
	r15 = r1->data;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->geom;
	if( r14 == NULL ) hl_null_access();
	r9 = 1;
	r12 = 0;
	iron_data_Geometry_setupInstanced(r14,r8,r9,r12);
	return;
}

double iron_object_ParticleSystem_fhash(iron__object__ParticleSystem r0,int r1) {
	double r2, r3, r4;
	r2 = (double)r1;
	r3 = 1.;
	r2 = r2 + r3;
	r4 = 9301.;
	r4 = fmod(r4,r2);
	r3 = r2 * r4;
	r4 = 9301.;
	r3 = r3 * r4;
	r4 = 49297.;
	r3 = r3 + r4;
	r4 = 233280.;
	r3 = fmod(r3,r4);
	r4 = 233280.;
	r3 = r3 / r4;
	return r3;
}

void iron_object_ParticleSystem_remove(iron__object__ParticleSystem r0) {
	return;
}

void iron_object_ParticleSystem_new(iron__object__ParticleSystem r0,String r1,iron__data__TParticleReference r2) {
	String r27;
	hl__types__ArrayObj r23;
	hl_type *r25;
	bool r26;
	float r5, r6, r7, r8, r9, r10, r11, r12, r13, r14, r15, r16, r17, r18, r19, r20;
	iron__math__Mat4 r3;
	vclosure *r28;
	double r4;
	varray *r24;
	int r22;
	r3 = (iron__math__Mat4)hl_alloc_obj(&t$iron_math_Mat4);
	r4 = 1.;
	r5 = (float)r4;
	r4 = 0.;
	r6 = (float)r4;
	r4 = 0.;
	r7 = (float)r4;
	r4 = 0.;
	r8 = (float)r4;
	r4 = 0.;
	r9 = (float)r4;
	r4 = 1.;
	r10 = (float)r4;
	r4 = 0.;
	r11 = (float)r4;
	r4 = 0.;
	r12 = (float)r4;
	r4 = 0.;
	r13 = (float)r4;
	r4 = 0.;
	r14 = (float)r4;
	r4 = 1.;
	r15 = (float)r4;
	r4 = 0.;
	r16 = (float)r4;
	r4 = 0.;
	r17 = (float)r4;
	r4 = 0.;
	r18 = (float)r4;
	r4 = 0.;
	r19 = (float)r4;
	r4 = 1.;
	r20 = (float)r4;
	iron_math_Mat4_new(r3,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15,r16,r17,r18,r19,r20);
	r0->m = r3;
	r4 = 0.;
	r0->lapTime = r4;
	r22 = 0;
	r0->lap = r22;
	r22 = 0;
	r0->count = r22;
	r22 = 0;
	r0->seed = r22;
	r4 = 0.;
	r0->spawnRate = r4;
	r4 = 0.;
	r0->time = r4;
	r4 = 0.;
	r0->animtime = r4;
	r4 = 0.;
	r0->lifetime = r4;
	r22 = 24;
	r0->frameRate = r22;
	r4 = 1.;
	r0->speed = r4;
	if( r2 == NULL ) hl_null_access();
	r22 = r2->seed;
	r0->seed = r22;
	r25 = &t$iron_object_Particle;
	r22 = 0;
	r24 = hl_alloc_array(r25,r22);
	r23 = hl_types_ArrayObj_alloc(r24);
	r0->particles = r23;
	r26 = false;
	r0->ready = r26;
	r27 = r2->particle;
	r28 = hl_alloc_closure_ptr(&t$fun_9cbeb3a,iron_object_ParticleSystem_new__$1,r0);
	iron_data_Data_getParticle(r1,r27,r28);
	return;
}

